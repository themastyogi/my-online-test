import React, { useState, useEffect } from 'react';
import { Clock, ChevronLeft, ChevronRight, CheckCircle, XCircle, AlertCircle } from 'lucide-react';

const UPSCOnlineTest = () => {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState({});
  const [timeLeft, setTimeLeft] = useState(7200); // 2 hours in seconds
  const [showResult, setShowResult] = useState(false);
  const [testStarted, setTestStarted] = useState(false);

  const questions = [
    {
      id: 1,
      question: "The Constitution of India was adopted on:",
      options: ["26th January 1950", "26th November 1949", "15th August 1947", "26th January 1949"],
      correct: 1
    },
    {
      id: 2,
      question: "Which of the following is NOT a feature borrowed from the British Constitution?",
      options: ["Parliamentary system", "Rule of law", "Fundamental Rights", "Bicameral legislature"],
      correct: 2
    },
    {
      id: 3,
      question: "The words 'Socialist' and 'Secular' were added to the Preamble by which Amendment?",
      options: ["42nd Amendment", "44th Amendment", "43rd Amendment", "45th Amendment"],
      correct: 0
    },
    {
      id: 4,
      question: "Who is known as the 'Father of the Indian Constitution'?",
      options: ["Mahatma Gandhi", "Dr. B.R. Ambedkar", "Jawaharlal Nehru", "Sardar Vallabhbhai Patel"],
      correct: 1
    },
    {
      id: 5,
      question: "Which Article provides for the Right to Constitutional Remedies?",
      options: ["Article 30", "Article 31", "Article 32", "Article 33"],
      correct: 2
    },
    {
      id: 6,
      question: "The President of India is elected by:",
      options: ["Direct election by people", "Electoral College", "Parliament", "State Legislatures"],
      correct: 1
    },
    {
      id: 7,
      question: "What is the minimum age required to become President of India?",
      options: ["30 years", "35 years", "40 years", "45 years"],
      correct: 1
    },
    {
      id: 8,
      question: "The Vice President acts as:",
      options: ["Deputy Prime Minister", "Chairman of Rajya Sabha", "Leader of Opposition", "Chief Advisor to President"],
      correct: 1
    },
    {
      id: 9,
      question: "The maximum strength of Lok Sabha is:",
      options: ["525", "530", "545", "552"],
      correct: 3
    },
    {
      id: 10,
      question: "Members of Rajya Sabha are elected for a term of:",
      options: ["4 years", "5 years", "6 years", "7 years"],
      correct: 2
    },
    {
      id: 11,
      question: "A Money Bill can be introduced only in:",
      options: ["Lok Sabha", "Rajya Sabha", "Either House", "Joint sitting"],
      correct: 0
    },
    {
      id: 12,
      question: "The Supreme Court of India was established in:",
      options: ["1947", "1948", "1950", "1951"],
      correct: 2
    },
    {
      id: 13,
      question: "The retirement age of Supreme Court judges is:",
      options: ["62 years", "65 years", "68 years", "70 years"],
      correct: 1
    },
    {
      id: 14,
      question: "The concept of Basic Structure was established in:",
      options: ["Golak Nath case", "Kesavananda Bharati case", "Minerva Mills case", "Maneka Gandhi case"],
      correct: 1
    },
    {
      id: 15,
      question: "The Constitution provides for how many lists for distribution of powers?",
      options: ["Two", "Three", "Four", "Five"],
      correct: 1
    },
    {
      id: 16,
      question: "In case of conflict between Union and State laws on concurrent subjects:",
      options: ["State law prevails", "Union law prevails", "Both are invalid", "Courts decide"],
      correct: 1
    },
    {
      id: 17,
      question: "The Governor of a state is appointed by:",
      options: ["President", "Prime Minister", "Chief Minister", "State Legislature"],
      correct: 0
    },
    {
      id: 18,
      question: "The Election Commission of India is established under:",
      options: ["Article 324", "Article 325", "Article 326", "Article 327"],
      correct: 0
    },
    {
      id: 19,
      question: "The minimum age for voting in India is:",
      options: ["18 years", "21 years", "25 years", "30 years"],
      correct: 0
    },
    {
      id: 20,
      question: "The anti-defection law is provided under:",
      options: ["9th Schedule", "10th Schedule", "11th Schedule", "12th Schedule"],
      correct: 1
    },
    {
      id: 21,
      question: "The Preamble to the Indian Constitution declares India as:",
      options: ["A Union of States", "A Federation", "A Sovereign Socialist Secular Democratic Republic", "A Parliamentary Democracy"],
      correct: 2
    },
    {
      id: 22,
      question: "Which Article of the Constitution defines the territory of India?",
      options: ["Article 1", "Article 2", "Article 3", "Article 4"],
      correct: 0
    },
    {
      id: 23,
      question: "The Constitution of India came into force on:",
      options: ["26th November 1949", "15th August 1947", "26th January 1950", "2nd October 1950"],
      correct: 2
    },
    {
      id: 24,
      question: "The Constituent Assembly had how many members initially?",
      options: ["389", "296", "385", "299"],
      correct: 0
    },
    {
      id: 25,
      question: "Which Article empowers Parliament to form new states?",
      options: ["Article 2", "Article 3", "Article 4", "Article 5"],
      correct: 1
    },
    {
      id: 26,
      question: "The Constitution of India is:",
      options: ["Completely rigid", "Completely flexible", "Partly rigid and partly flexible", "Neither rigid nor flexible"],
      correct: 2
    },
    {
      id: 27,
      question: "Which part of the Constitution deals with Fundamental Rights?",
      options: ["Part II", "Part III", "Part IV", "Part V"],
      correct: 1
    },
    {
      id: 28,
      question: "The concept of 'Procedure established by law' is taken from:",
      options: ["British Constitution", "US Constitution", "Japanese Constitution", "Canadian Constitution"],
      correct: 2
    },
    {
      id: 29,
      question: "Which Article abolished untouchability?",
      options: ["Article 15", "Article 16", "Article 17", "Article 18"],
      correct: 2
    },
    {
      id: 30,
      question: "The Right to Property was deleted from Fundamental Rights by which Amendment?",
      options: ["42nd Amendment", "43rd Amendment", "44th Amendment", "45th Amendment"],
      correct: 2
    },
    {
      id: 31,
      question: "The Directive Principles of State Policy are contained in:",
      options: ["Part III", "Part IV", "Part V", "Part VI"],
      correct: 1
    },
    {
      id: 32,
      question: "Which Article provides for Uniform Civil Code?",
      options: ["Article 43", "Article 44", "Article 45", "Article 46"],
      correct: 1
    },
    {
      id: 33,
      question: "The President can be impeached for:",
      options: ["Violation of Constitution only", "Violation of Constitution and misconduct", "Any criminal act", "Incompetence"],
      correct: 0
    },
    {
      id: 34,
      question: "Who administers the oath of office to the President?",
      options: ["Prime Minister", "Speaker of Lok Sabha", "Chief Justice of India", "Vice President"],
      correct: 2
    },
    {
      id: 35,
      question: "The President can dissolve:",
      options: ["Lok Sabha only", "Rajya Sabha only", "Both Houses of Parliament", "State Assemblies"],
      correct: 0
    },
    {
      id: 36,
      question: "Which Article deals with the pardoning power of the President?",
      options: ["Article 70", "Article 71", "Article 72", "Article 73"],
      correct: 2
    },
    {
      id: 37,
      question: "The Prime Minister is appointed by:",
      options: ["President", "Parliament", "Lok Sabha", "People directly"],
      correct: 0
    },
    {
      id: 38,
      question: "The Council of Ministers is collectively responsible to:",
      options: ["President", "Prime Minister", "Lok Sabha", "Parliament"],
      correct: 2
    },
    {
      id: 39,
      question: "How many types of emergencies are provided in the Constitution?",
      options: ["Two", "Three", "Four", "Five"],
      correct: 1
    },
    {
      id: 40,
      question: "National Emergency can be declared under:",
      options: ["Article 352", "Article 356", "Article 360", "Article 365"],
      correct: 0
    },
    {
      id: 41,
      question: "The Parliament of India consists of:",
      options: ["Lok Sabha and Rajya Sabha", "President and Parliament", "President, Lok Sabha and Rajya Sabha", "Prime Minister and Parliament"],
      correct: 2
    },
    {
      id: 42,
      question: "The present strength of Lok Sabha is:",
      options: ["543", "545", "550", "552"],
      correct: 1
    },
    {
      id: 43,
      question: "The maximum strength of Rajya Sabha is:",
      options: ["238", "245", "250", "255"],
      correct: 2
    },
    {
      id: 44,
      question: "How many members of Rajya Sabha retire every two years?",
      options: ["One-fourth", "One-third", "One-half", "Two-thirds"],
      correct: 1
    },
    {
      id: 45,
      question: "The minimum age to become a member of Lok Sabha is:",
      options: ["21 years", "25 years", "30 years", "35 years"],
      correct: 1
    },
    {
      id: 46,
      question: "The minimum age to become a member of Rajya Sabha is:",
      options: ["25 years", "30 years", "35 years", "40 years"],
      correct: 1
    },
    {
      id: 47,
      question: "Who certifies a bill as Money Bill?",
      options: ["President", "Prime Minister", "Speaker of Lok Sabha", "Finance Minister"],
      correct: 2
    },
    {
      id: 48,
      question: "Rajya Sabha can detain a Money Bill for maximum:",
      options: ["10 days", "14 days", "20 days", "30 days"],
      correct: 1
    },
    {
      id: 49,
      question: "A joint sitting of Parliament is presided over by:",
      options: ["President", "Vice President", "Speaker of Lok Sabha", "Chairman of Rajya Sabha"],
      correct: 2
    },
    {
      id: 50,
      question: "The Speaker of Lok Sabha is elected by:",
      options: ["President", "Prime Minister", "Members of Lok Sabha", "Members of Parliament"],
      correct: 2
    }
  ];

  // Timer effect
  useEffect(() => {
    let timer;
    if (testStarted && timeLeft > 0 && !showResult) {
      timer = setInterval(() => {
        setTimeLeft(prevTime => prevTime - 1);
      }, 1000);
    } else if (timeLeft === 0 && !showResult) {
      handleSubmit();
    }
    return () => clearInterval(timer);
  }, [testStarted, timeLeft, showResult]);

  const formatTime = (seconds) => {
    const hours = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  const handleAnswerSelect = (questionId, optionIndex) => {
    setAnswers(prev => ({
      ...prev,
      [questionId]: optionIndex
    }));
  };

  const calculateScore = () => {
    let correct = 0;
    let incorrect = 0;
    let unanswered = 0;

    questions.forEach(question => {
      const userAnswer = answers[question.id];
      if (userAnswer === undefined) {
        unanswered++;
      } else if (userAnswer === question.correct) {
        correct++;
      } else {
        incorrect++;
      }
    });

    const positiveMarks = correct * 2;
    const negativeMarks = incorrect * (2/3);
    const finalScore = positiveMarks - negativeMarks;

    return {
      correct,
      incorrect,
      unanswered,
      positiveMarks,
      negativeMarks: negativeMarks.toFixed(2),
      finalScore: finalScore.toFixed(2),
      totalQuestions: questions.length
    };
  };

  const handleSubmit = () => {
    setShowResult(true);
  };

  const startTest = () => {
    setTestStarted(true);
  };

  const resetTest = () => {
    setCurrentQuestion(0);
    setAnswers({});
    setTimeLeft(7200);
    setShowResult(false);
    setTestStarted(false);
  };

  const getQuestionStatus = (questionId) => {
    const userAnswer = answers[questionId];
    if (userAnswer === undefined) return 'unanswered';
    const question = questions.find(q => q.id === questionId);
    return userAnswer === question.correct ? 'correct' : 'incorrect';
  };

  if (!testStarted) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
        <div className="bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full">
          <h1 className="text-3xl font-bold text-center mb-6 text-blue-600">
            UPSC Online Test Paper
          </h1>
          <div className="space-y-4 mb-8">
            <div className="bg-blue-50 p-4 rounded-lg">
              <h3 className="font-semibold text-blue-800 mb-2">Test Instructions:</h3>
              <ul className="text-sm text-blue-700 space-y-1">
                <li>• Total Questions: 50 (Sample from 100 questions)</li>
                <li>• Duration: 2 hours (120 minutes)</li>
                <li>• Marks: +2 for correct answer, -0.66 for wrong answer</li>
                <li>• No negative marking for unanswered questions</li>
                <li>• You can navigate between questions freely</li>
                <li>• Submit before time expires</li>
              </ul>
            </div>
            <div className="bg-yellow-50 p-4 rounded-lg">
              <h3 className="font-semibold text-yellow-800 mb-2">Marking Scheme:</h3>
              <p className="text-sm text-yellow-700">
                For every correct answer: +2 marks<br/>
                For every incorrect answer: -0.66 marks (1/3 of 2 marks)<br/>
                For unanswered questions: 0 marks
              </p>
            </div>
          </div>
          <button
            onClick={startTest}
            className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-semibold"
          >
            Start Test
          </button>
        </div>
      </div>
    );
  }

  if (showResult) {
    const result = calculateScore();
    return (
      <div className="min-h-screen bg-gray-50 p-4">
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-2xl font-bold text-center mb-6 text-green-600">Test Results</h2>
            
            <div className="grid md:grid-cols-2 gap-6 mb-6">
              <div className="bg-green-50 p-4 rounded-lg">
                <h3 className="font-semibold text-green-800 mb-3">Score Summary</h3>
                <div className="space-y-2 text-sm">
                  <div className="flex justify-between">
                    <span>Correct Answers:</span>
                    <span className="font-semibold text-green-600">{result.correct}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Incorrect Answers:</span>
                    <span className="font-semibold text-red-600">{result.incorrect}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Unanswered:</span>
                    <span className="font-semibold text-gray-600">{result.unanswered}</span>
                  </div>
                  <hr className="my-2" />
                  <div className="flex justify-between">
                    <span>Positive Marks:</span>
                    <span className="font-semibold text-green-600">+{result.positiveMarks}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Negative Marks:</span>
                    <span className="font-semibold text-red-600">-{result.negativeMarks}</span>
                  </div>
                  <hr className="my-2" />
                  <div className="flex justify-between text-lg font-bold">
                    <span>Final Score:</span>
                    <span className="text-blue-600">{result.finalScore}/100</span>
                  </div>
                </div>
              </div>
              
              <div className="bg-blue-50 p-4 rounded-lg">
                <h3 className="font-semibold text-blue-800 mb-3">Performance Analysis</h3>
                <div className="space-y-2 text-sm">
                  <div className="flex justify-between">
                    <span>Accuracy:</span>
                    <span className="font-semibold">{((result.correct / (result.correct + result.incorrect)) * 100).toFixed(1)}%</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Attempted:</span>
                    <span className="font-semibold">{result.correct + result.incorrect}/{result.totalQuestions}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Percentage:</span>
                    <span className="font-semibold">{((result.finalScore / 100) * 100).toFixed(1)}%</span>
                  </div>
                </div>
              </div>
            </div>

            <div className="mb-6">
              <h3 className="font-semibold mb-3">Question-wise Analysis:</h3>
              <div className="grid grid-cols-10 gap-2">
                {questions.map(question => {
                  const status = getQuestionStatus(question.id);
                  return (
                    <div
                      key={question.id}
                      className={`w-8 h-8 rounded flex items-center justify-center text-xs font-semibold ${
                        status === 'correct' ? 'bg-green-500 text-white' :
                        status === 'incorrect' ? 'bg-red-500 text-white' :
                        'bg-gray-300 text-gray-600'
                      }`}
                    >
                      {question.id}
                    </div>
                  );
                })}
              </div>
              <div className="flex gap-4 mt-3 text-sm">
                <div className="flex items-center gap-1">
                  <div className="w-4 h-4 bg-green-500 rounded"></div>
                  <span>Correct</span>
                </div>
                <div className="flex items-center gap-1">
                  <div className="w-4 h-4 bg-red-500 rounded"></div>
                  <span>Incorrect</span>
                </div>
                <div className="flex items-center gap-1">
                  <div className="w-4 h-4 bg-gray-300 rounded"></div>
                  <span>Unanswered</span>
                </div>
              </div>
            </div>
            
            <button
              onClick={resetTest}
              className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-semibold"
            >
              Take New Test
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white shadow-sm border-b">
        <div className="max-w-6xl mx-auto px-4 py-3">
          <div className="flex justify-between items-center">
            <h1 className="text-xl font-bold text-gray-800">UPSC Online Test</h1>
            <div className="flex items-center gap-4">
              <div className="flex items-center gap-2 bg-red-50 px-3 py-1 rounded-lg">
                <Clock className="w-4 h-4 text-red-600" />
                <span className="font-mono text-red-600">{formatTime(timeLeft)}</span>
              </div>
              <button
                onClick={handleSubmit}
                className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
              >
                Submit Test
              </button>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-6xl mx-auto p-4">
        <div className="grid lg:grid-cols-4 gap-6">
          {/* Question Panel */}
          <div className="lg:col-span-3">
            <div className="bg-white rounded-lg shadow-lg p-6">
              <div className="mb-4">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-medium text-gray-600">
                    Question {currentQuestion + 1} of {questions.length}
                  </span>
                  <span className="text-sm text-gray-500">
                    {answers[questions[currentQuestion].id] !== undefined ? 'Answered' : 'Not Answered'}
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div
                    className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                    style={{ width: `${((currentQuestion + 1) / questions.length) * 100}%` }}
                  ></div>
                </div>
              </div>

              <div className="mb-6">
                <h3 className="text-lg font-semibold mb-4">
                  {questions[currentQuestion].question}
                </h3>
                <div className="space-y-3">
                  {questions[currentQuestion].options.map((option, index) => (
                    <label
                      key={index}
                      className={`block p-3 rounded-lg border cursor-pointer transition-colors ${
                        answers[questions[currentQuestion].id] === index
                          ? 'border-blue-500 bg-blue-50'
                          : 'border-gray-300 hover:border-gray-400'
                      }`}
                    >
                      <input
                        type="radio"
                        name={`question-${questions[currentQuestion].id}`}
                        value={index}
                        checked={answers[questions[currentQuestion].id] === index}
                        onChange={() => handleAnswerSelect(questions[currentQuestion].id, index)}
                        className="mr-3"
                      />
                      <span className="font-medium mr-2">
                        {String.fromCharCode(65 + index)}.
                      </span>
                      {option}
                    </label>
                  ))}
                </div>
              </div>

              <div className="flex justify-between">
                <button
                  onClick={() => setCurrentQuestion(Math.max(0, currentQuestion - 1))}
                  disabled={currentQuestion === 0}
                  className="flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                  <ChevronLeft className="w-4 h-4" />
                  Previous
                </button>
                <button
                  onClick={() => setCurrentQuestion(Math.min(questions.length - 1, currentQuestion + 1))}
                  disabled={currentQuestion === questions.length - 1}
                  className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                  Next
                  <ChevronRight className="w-4 h-4" />
                </button>
              </div>
            </div>
          </div>

          {/* Question Navigation Panel */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-lg shadow-lg p-4 sticky top-4">
              <h3 className="font-semibold mb-4">Question Navigation</h3>
              <div className="grid grid-cols-5 gap-2 mb-4">
                {questions.map((question, index) => (
                  <button
                    key={question.id}
                    onClick={() => setCurrentQuestion(index)}
                    className={`w-10 h-10 rounded text-sm font-semibold transition-colors ${
                      index === currentQuestion
                        ? 'bg-blue-600 text-white'
                        : answers[question.id] !== undefined
                        ? 'bg-green-500 text-white'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    {index + 1}
                  </button>
                ))}
              </div>
              <div className="space-y-2 text-sm">
                <div className="flex items-center gap-2">
                  <div className="w-4 h-4 bg-green-500 rounded"></div>
                  <span>Answered: {Object.keys(answers).length}</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-4 h-4 bg-gray-300 rounded"></div>
                  <span>Not Answered: {questions.length - Object.keys(answers).length}</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-4 h-4 bg-blue-600 rounded"></div>
                  <span>Current Question</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default UPSCOnlineTest;